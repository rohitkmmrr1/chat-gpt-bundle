<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sortable List App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Sortable.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom styles for drag-and-drop feedback */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #cbd5e1; /* Tailwind gray-300 */
        }
        .sortable-chosen {
            background-color: #dbeafe; /* Tailwind blue-100 */
        }
        .sortable-drag {
            opacity: 0.9;
        }
        /* Ensure the drag handle is clearly clickable */
        .drag-handle {
            touch-action: none; /* Prevent browser default touch actions */
        }
    </style>
</head>
<!-- The body is now a flex container spanning the full screen height and width -->
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 h-screen w-screen flex overflow-hidden">

    <!-- Left side: The main application content -->
    <div class="w-1/2 flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full h-full flex flex-col border border-gray-200">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-6 text-center">Sortable List Generator</h1>

            <!-- Input and Generate Section -->
            <div class="mb-6 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                <input
                    type="number"
                    id="numItemsInput"
                    placeholder="Enter number of items (e.g., 10)"
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 shadow-sm"
                    min="1"
                    value="10"
                >
                <button
                    id="generateListBtn"
                    class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                >
                    Generate List
                </button>
            </div>

            <!-- List Container: flex-grow makes it take available vertical space, overflow-y-auto enables scrolling -->
            <div id="listContainer" class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex-grow overflow-y-auto mb-6 shadow-inner">
                <ul id="sortableList" class="space-y-2">
                    <!-- List items will be injected here by JavaScript -->
                </ul>
            </div>

            <!-- Export Section -->
            <div class="mb-6">
                <button
                    id="exportIndicesBtn"
                    class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                >
                    Export Old and New Indices
                </button>
            </div>

            <!-- Exported Results Display -->
            <div id="resultsContainer" class="bg-gray-800 text-white p-4 rounded-lg font-mono text-sm overflow-x-auto shadow-lg hidden">
                <h2 class="text-xl font-semibold mb-2 text-gray-200">Exported Indices:</h2>
                <pre id="exportedResults" class="whitespace-pre-wrap break-words"></pre>
            </div>

            <!-- Message Box for alerts -->
            <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                    <p id="messageText" class="text-lg font-medium text-gray-800 mb-4"></p>
                    <button id="closeMessageBox" class="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right side: Blank area -->
    <div class="w-1/2 bg-gray-200 flex items-center justify-center border-l border-gray-300">
        <p class="text-gray-400 text-2xl font-semibold">Right Side Area</p>
    </div>

    <script>
        // Get references to DOM elements
        const numItemsInput = document.getElementById('numItemsInput');
        const generateListBtn = document.getElementById('generateListBtn');
        const sortableList = document.getElementById('sortableList');
        const exportIndicesBtn = document.getElementById('exportIndicesBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const exportedResults = document.getElementById('exportedResults');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBox = document.getElementById('closeMessageBox');

        let sortableInstance; // To store the Sortable.js instance

        /**
         * Displays a custom message box instead of `alert()`.
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        // Event listener for closing the message box
        closeMessageBox.addEventListener('click', hideMessageBox);


        /**
         * Generates a list of items based on the input number.
         * Each item stores its original index as a data attribute.
         */
        function generateList() {
            const numItems = parseInt(numItemsInput.value, 10);

            // Input validation
            if (isNaN(numItems) || numItems <= 0) {
                showMessageBox('Please enter a valid number greater than 0.');
                return;
            }
            if (numItems > 5000) { // Increased limit for more items, but still prevent extreme cases
                showMessageBox('Please enter a number up to 5000 for better performance.');
                return;
            }

            // Clear existing list items
            sortableList.innerHTML = '';

            // Destroy previous Sortable instance if it exists to prevent re-initialization issues
            if (sortableInstance) {
                sortableInstance.destroy();
            }

            // Create new list items
            for (let i = 0; i < numItems; i++) {
                const listItem = document.createElement('li');
                listItem.classList.add(
                    'p-3', 'bg-white', 'rounded-md', 'shadow-sm', 'border', 'border-gray-200',
                    'flex', 'items-center', 'justify-between',
                    'hover:bg-gray-100', 'transition', 'duration-150', 'ease-in-out'
                );
                // Store the original index as a data attribute
                listItem.dataset.originalIndex = i;

                // Create the drag handle (the only part that triggers drag)
                const dragHandle = document.createElement('span');
                dragHandle.classList.add(
                    'drag-handle', 'cursor-grab', 'text-gray-400', 'hover:text-gray-600',
                    'mr-3', 'text-xl', 'p-1', 'rounded', 'hover:bg-gray-200', 'transition'
                );
                // Using vertical ellipsis character as a drag icon
                dragHandle.innerHTML = '&#x22EE;'; // Unicode for Vertical Ellipsis

                // Create the text content for the list item
                const itemText = document.createElement('span');
                itemText.textContent = `Item ${i + 1}`;
                itemText.classList.add('flex-grow', 'text-gray-800'); // Make text take up remaining space

                // Append handle and text to the list item
                listItem.appendChild(dragHandle);
                listItem.appendChild(itemText);
                sortableList.appendChild(listItem);
            }

            // Initialize Sortable.js on the list
            sortableInstance = Sortable.create(sortableList, {
                animation: 150, // ms, animation speed moving items when sorting, `0` â€” no animation
                ghostClass: 'sortable-ghost', // Class name for the drop placeholder
                chosenClass: 'sortable-chosen', // Class name for the chosen item
                dragClass: 'sortable-drag', // Class name for the dragging item
                handle: '.drag-handle', // ONLY drag by the element with this class
            });

            // Hide previous results
            resultsContainer.classList.add('hidden');
            exportedResults.textContent = '';
        }

        /**
         * Exports the old and new indices of the list items.
         */
        function exportIndices() {
            const items = Array.from(sortableList.children);
            if (items.length === 0) {
                showMessageBox('Please generate a list first.');
                return;
            }

            const indices = items.map((item, newIndex) => {
                const oldIndex = parseInt(item.dataset.originalIndex, 10);
                return {
                    oldIndex: oldIndex,
                    newIndex: newIndex
                };
            });

            exportedResults.textContent = JSON.stringify(indices, null, 2);
            resultsContainer.classList.remove('hidden');
        }

        // Event Listeners
        generateListBtn.addEventListener('click', generateList);
        exportIndicesBtn.addEventListener('click', exportIndices);

        // Initial list generation on page load
        window.onload = () => {
            generateList();
        };
    </script>
</body>
</html>
